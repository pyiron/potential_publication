

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>High-Dimensional Neural Network Potentials &#8212; potentials_publication</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '02_fitting/02-HDNNP/handson';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Atomic cluster expansion (ACE)" href="../03-ACE/pacemaker_example.html" />
    <link rel="prev" title="EAM potentials 1: Introduction" href="../01-EAM/IntroductionPotentialFitting.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo_dark.png" class="logo__image only-light" alt="potentials_publication - Home"/>
    <script>document.write(`<img src="../../_static/logo_dark.png" class="logo__image only-dark" alt="potentials_publication - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../README.html">
                    potentials publication
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../01_data_generation/01_generating_data.html">Generating data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_data_generation/02_creating_training_container.html">Creating training data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-EAM/HandsOnPotenitalFitting.html">EAM potentials 2: Hands on</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-EAM/IntroductionPotentialFitting.html">EAM potentials 1: Introduction</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">High-Dimensional Neural Network Potentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-ACE/pacemaker_example.html">Atomic cluster expansion (ACE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03_validation/01_running_validation.html">Elastic constants and phonos</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../03_validation/Fig5_Fig7.html">Normal EV curves</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../example.html">pyiron example notebook</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/pyiron/potentials_publication/master?urlpath=lab/tree/02_fitting/02-HDNNP/handson.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/02_fitting/02-HDNNP/handson.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>High-Dimensional Neural Network Potentials</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#architecture-of-an-hdnnp">Architecture of an HDNNP</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#symmetry-functions-sfs">Symmetry Functions (SFs)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cutoff-functions">Cutoff Functions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#radial-symmetry-functions">Radial Symmetry Functions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#angular-symmetry-functions">Angular Symmetry Functions</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rd-and-4th-generation-hdnnps">3rd and 4th Generation HDNNPs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#repetition-second-generation-hdnnp">Repetition: Second Generation HDNNP</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#third-generation-hdnnp">Third Generation HDNNP</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fourth-generation-hdnnp">Fourth Generation HDNNP</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-runner-via-the-pyiron-interface">Using RuNNer via the pyiron Interface</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data Preparation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#job-setup-runnerfit">Job Setup: <code class="docutils literal notranslate"><span class="pre">RunnerFit</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-training-data">Adding Training Data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#specification-of-runner-parameters">Specification of RuNNer Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-sfs-with-runnerase">Generating SFs with <code class="docutils literal notranslate"><span class="pre">runnerase</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-sfs-to-the-job">Adding SFs to the Job</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mode-1-calculation-of-sf-values">Mode 1: Calculation of SF Values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mode-2-potential-training">Mode 2: Potential Training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mode-3-potential-evaluation">Mode 3: Potential Evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lammps-using-the-potential">LAMMPS: Using the Potential</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resources">Resources</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><img alt="Logo" src="02_fitting/02-HDNNP/figures/GOE_Logo_Quer_IPC_Farbe_RGB.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="high-dimensional-neural-network-potentials">
<h1>High-Dimensional Neural Network Potentials<a class="headerlink" href="#high-dimensional-neural-network-potentials" title="Permalink to this heading">#</a></h1>
<p><strong><a class="reference external" href="mailto:aknoll&#37;&#52;&#48;chemie&#46;uni-goettingen&#46;de">Alexander L<span>&#46;</span> M<span>&#46;</span> Knoll</a>, and <a class="reference external" href="mailto:moritzrichard&#46;schaefer&#37;&#52;&#48;uni-goettingen&#46;de">Moritz R<span>&#46;</span> Schäfer</a></strong></p>
<p>Behler Group, Theoretische Chemie, Institut für Physikalische Chemie</p>
<p>For this tutorial it is intended to use the RuNNer release version 1.2, available in conda-forge.
The most recent version of RuNNer is <a class="reference external" href="https://gitlab.com/TheochemGoettingen/RuNNer">hosted on Gitlab</a>. For access please contact Prof. Dr. Jörg Behler (<a class="reference external" href="mailto:joerg&#46;behler&#37;&#52;&#48;uni-goettingen&#46;de">joerg<span>&#46;</span>behler<span>&#64;</span>uni-goettingen<span>&#46;</span>de</a>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">ipympl</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>

<span class="kn">from</span> <span class="nn">pyiron_atomistics</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">pyiron_contrib.atomistics.runner.job</span> <span class="kn">import</span> <span class="n">RunnerFit</span>
<span class="kn">from</span> <span class="nn">pyiron_contrib.atomistics.runner.utils</span> <span class="kn">import</span> <span class="n">container_to_ase</span>

<span class="kn">from</span> <span class="nn">ase.geometry</span> <span class="kn">import</span> <span class="n">get_distances</span>

<span class="kn">from</span> <span class="nn">runnerase</span> <span class="kn">import</span> <span class="n">generate_symmetryfunctions</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/kalm/.pyenv/versions/pyiron/lib/python3.10/site-packages/paramiko/transport.py:236: CryptographyDeprecationWarning: Blowfish has been deprecated
  &quot;class&quot;: algorithms.Blowfish,
</pre></div>
</div>
</div>
</div>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">#</a></h2>
<section id="architecture-of-an-hdnnp">
<h3>Architecture of an HDNNP<a class="headerlink" href="#architecture-of-an-hdnnp" title="Permalink to this heading">#</a></h3>
<p><strong>RuNNer</strong> is a stand-alone Fortran program for the construction of high-dimensional neural network potentials (HDNNPs), written mainly by Jörg Behler. The central assumption made in constructing a HDNNP is that the total energy of the system <span class="math notranslate nohighlight">\(E_{\mathrm{tot}}\)</span> <a class="reference external" href="https://www.doi.org/10.1103/PhysRevLett.98.146401">can be separated into atomic contributions <span class="math notranslate nohighlight">\(E_i\)</span></a>. HDNNP relates the local environment of the atoms to their atomic energies <span class="math notranslate nohighlight">\(E_i\)</span>, which contribute to the sum of all <span class="math notranslate nohighlight">\(N\)</span> atomic energies, resulting in the total energy of the system <span class="math notranslate nohighlight">\(E_\mathrm{tot}\)</span>.</p>
<p>\begin{align}
E_\mathrm{tot} = \sum_{i}^{N}E_i\notag
\end{align}</p>
<p>Every atomic energy is described by an atomic neural network (NN), which is element-specific. The entirety of all atomic NNs composes a HDNNP, whose general architecture is shown below for a binary system.</p>
<img src="figures/2g.png" class="center" width="500"/><p>As you can see, the atomic contributions in this model are predicted independently from each other. Therefore, the model can easily describe systems with differering numbers of atoms: adding or removing an atom corresponds to adding or removing a row in the figure shown above. This ability is what puts the “high-dimensional” into the name “HDNNP”.</p>
<p>Each atomic neural networks receives input information about the local atomic environment up to a certain cutoff radius <span class="math notranslate nohighlight">\(R_{\mathrm{c}}\)</span>. This information is encoded based on the Cartesian coordinates in many-body descriptors, so-called <a class="reference external" href="https://www.doi.org/10.1063/1.3553717">atom-centered symmetry functions (ACSF or just SF)</a>. More details about this are shown below. For each atom, the values of multiple SFs compose a SF vector <span class="math notranslate nohighlight">\(G\)</span> which is the input layer of the atomic NNs.</p>
<p>Atomic NNs look like this:</p>
<img src="figures/ann.png" width="500"/><p>Every value in the SF vector <span class="math notranslate nohighlight">\(G\)</span> serves as one piece of input information to the atomic NN. We refer to the circles in the figure as <em>nodes</em> (from graph theory) or <em>neurons</em> (from neural science). The information from the input nodes flows through the atomic NN from left to right: the input layer is followed by a configurable number of hidden layers which consist, in turn, of an arbitrary number of <em>hidden nodes</em>. At the end, all information is collected in the output layer, which in our case is interpreted as the atomic energy contribution of the atom under consideration. The input nodes and the hidden nodes in the first layer are connected by weights. Moreover, the hidden and output nodes carry a bias value.</p>
<p>During training, the weights and biases are optimized using backpropagation to represent best the data in the training data set.</p>
</section>
<section id="symmetry-functions-sfs">
<h3>Symmetry Functions (SFs)<a class="headerlink" href="#symmetry-functions-sfs" title="Permalink to this heading">#</a></h3>
<p>SFs provide the input for the NN and describe the local atomic environment of each atom. In principle, one could also use Cartesian coordinates to capture the atomic positions in a structure. As Cartesian coordinates describe the absolute positions of atoms the numerical input to the atomic NNs would change with translation or rotation of the system. However, these actions do not influence the energy of the system and different numerical inputs belonging to the same NN output lead to large training errors.</p>
<p>In contrast, SFs describe the relative positions of the atoms to each other and are hence translationally and rotationally invariant. We differentiate two types of SFs: radial SF depend on the distance between atom pairs and serve as a measure for their bond order. Angular SFs additionally depend on the interatomic angles.</p>
<section id="cutoff-functions">
<h4>Cutoff Functions<a class="headerlink" href="#cutoff-functions" title="Permalink to this heading">#</a></h4>
<p>The cutoff function <span class="math notranslate nohighlight">\(f_{\mathrm{c}}\)</span> ensures that only the neighbors within one atomic environment counts towards the symmetry function values. The cutoff radius <span class="math notranslate nohighlight">\(R_\mathrm{c}\)</span> (usually <span class="math notranslate nohighlight">\(12\,\mathrm{bohr}\)</span>) defines how much of the local atomic environment is considered. All SFs and their derivatives will decrease to zero if the pairwise distance is larger than <span class="math notranslate nohighlight">\(R_\mathrm{c}\)</span>. There are several cutoff funtions defined in <strong>RuNNer</strong> and we will use here</p>
<p>\begin{align}
f_{c}(R_{ij}) =
\begin{cases}
0.5 \cdot [\cos(\pi x) + 1]&amp; ~ \text{for <span class="math notranslate nohighlight">\(R_{ij} \leq R_\mathrm{c}\)</span>},\
0&amp; ~ \text{for <span class="math notranslate nohighlight">\(R_{ij} &gt; R_\mathrm{c}\)</span>}
\end{cases}
\end{align}</p>
<p>with the atomic distance <span class="math notranslate nohighlight">\(R_{ij}\)</span>, the cutoff radius <span class="math notranslate nohighlight">\(R_\mathrm{c}\)</span>, and <span class="math notranslate nohighlight">\(x = \frac{R_{ij}}{R_{\mathrm{c}}}\)</span>.</p>
<p>Take a look at the figure below for a graphical representation of the cutoff radius in a periodic system: the red atom is the central atom for which the SF values will be calculated. All yellow atoms lie within in the cutoff radius and will therefore contribute to the SF values.</p>
<img src="figures/Rc.png" width="500"/></section>
<section id="radial-symmetry-functions">
<h4>Radial Symmetry Functions<a class="headerlink" href="#radial-symmetry-functions" title="Permalink to this heading">#</a></h4>
<p>To define the parameters for the radial SFs, it is important to know the shortest bond distance for each element combination in your data set. Usually, 5-6 radial SF are used for any element pair, with different <span class="math notranslate nohighlight">\(\eta\)</span> values to increase the resolution for structure description. It is possible to shift the maximum of the radial SF <span class="math notranslate nohighlight">\(G^2\)</span> by <span class="math notranslate nohighlight">\(R_{s}\)</span>.</p>
<p>\begin{align}
G_{i}^{2} = \sum_{j}^{}e^{-\eta (R_{ij} - R_{s})^2} \cdot f_{c}(R_{ij}).
\end{align}</p>
<p>In most applications, the Gaussian exponents <span class="math notranslate nohighlight">\(\eta\)</span> for the radial SFs are chosen such that the SF turning points are equally distributed between the cutoff radius and specific minimum pairwise distance in the training dataset (small eta <span class="math notranslate nohighlight">\(\eta\)</span> = max. contraction). In RuNNer, you can either define element pair specific SF or define global SF which are used for every element combination. It is also possible to define different cutoff radii for the SF, even though this is rarely helpful and therefore not recommended.</p>
<p>Below, you can see a graphical representation of the radial symmetry functions including the cutoff function for a cutoff radius of 12 Bohr.</p>
<img src="figures/radials.png" width="800"/></section>
<section id="angular-symmetry-functions">
<h4>Angular Symmetry Functions<a class="headerlink" href="#angular-symmetry-functions" title="Permalink to this heading">#</a></h4>
<p>The same rules apply to the angular SFs. Here, however, three atomic positions are included in the calculation.</p>
<p>\begin{align}
G_{i}^{3} = 2^{\zeta - 1}\sum_{j}^{} \sum_{k}^{} \left[( 1 + \lambda \cdot cos \theta_{ijk})^{\zeta} \cdot e^{-\eta (R_{ij}^2 + R_{ik}^2 + R_{jk}^2)} \cdot f_{\mathrm{c}}(R_{ij}) \cdot f_{\mathrm{c}}(R_{ik}) \cdot f_{\mathrm{c}}(R_{jk}) \right]
\end{align}</p>
<p>The angle <span class="math notranslate nohighlight">\(\theta_{ijk} = \frac{\mathbf{R}_{ij} \cdot \mathbf{R}_{ik}}{R_{ij} \cdot R_{ik}}\)</span> is centered at atom <span class="math notranslate nohighlight">\(i\)</span>. For most system, we use permutations of <span class="math notranslate nohighlight">\(\zeta = \{1, 2, 4, 16\}\)</span>, <span class="math notranslate nohighlight">\(\eta = 0\)</span>, and <span class="math notranslate nohighlight">\(\lambda\)</span> = <span class="math notranslate nohighlight">\(\{+1, -1\}\)</span>. If many atoms of each element are present, angular SFs are usually not critical and a default set of SFs can be used.</p>
<img src="figures/angulars.png" width="800"/></section>
</section>
<section id="rd-and-4th-generation-hdnnps">
<h3>3rd and 4th Generation HDNNPs<a class="headerlink" href="#rd-and-4th-generation-hdnnps" title="Permalink to this heading">#</a></h3>
<p>Due to time limitations, we will only focus on the model described above which is known as the second generation of HDNNPs (see <a class="reference external" href="https://www.doi.org/10.1103/PhysRevLett.98.146401">here</a>, and <a class="reference external" href="https://www.doi.org/10.1002/anie.201703114">here</a>, and <a class="reference external" href="https://www.doi.org/10.1002/qua.24890">here</a>). However, in recent years third- and fourth-generation HDNNPs were developed by the Behler group.</p>
<section id="repetition-second-generation-hdnnp">
<h4>Repetition: Second Generation HDNNP<a class="headerlink" href="#repetition-second-generation-hdnnp" title="Permalink to this heading">#</a></h4>
<img src="figures/2g.png" width="500"></section>
<section id="third-generation-hdnnp">
<h4>Third Generation HDNNP<a class="headerlink" href="#third-generation-hdnnp" title="Permalink to this heading">#</a></h4>
<p>In second-generation HDNNPs only atomic interactions inside the cutoff sphere are taken into account. The resulting short-ranged potentials are well-suited to describe local bonding even for complex atomic environments. However, it can be expected that for many systems long-range interactions, primarily electrostatics, will be important.</p>
<p>To overcome those limitations, third-generation NNs (see <a class="reference external" href="https://www.doi.org/10.1103/PhysRevB.83.153101">here</a>, and <a class="reference external" href="https://www.doi.org/10.1063/1.3682557">here</a>) define a second set of atomic neural networks to construct environment-dependent atomic charges. They can then be used to calculate the long-range electrostatic energy without truncation. The total energy of the system is then given by the sum of the short-range and the electrostatic energies.</p>
<img src="figures/3g.png" width="800"/></section>
<section id="fourth-generation-hdnnp">
<h4>Fourth Generation HDNNP<a class="headerlink" href="#fourth-generation-hdnnp" title="Permalink to this heading">#</a></h4>
<p>While the use of environment-dependent charges is a clear step forward, they are not sufficient if long-range charge transfer is present.</p>
<p>When dealing with systems where long-range charge transer is present, the usage of fourth-generation NNs (see <a class="reference external" href="https://www.doi.org/10.1038/s41467-020-20427-2">here</a>, and <a class="reference external" href="https://www.doi.org/10.1021/acs.accounts.0c00689">here</a>) is recommended. Here, environment-dependent electronegativities <span class="math notranslate nohighlight">\(\chi\)</span> are computed first. They will then be used in a charge equilibration scheme to determine the atomic charges <span class="math notranslate nohighlight">\(Q\)</span>. Again, we can compute the electrostatic energy from this. Moreover, the atomic charges serve as an additional input neuron to train the short-range energy and forces. As it was the case for the third-generation NNs the total energy is then given by the sum of the short-range and the electrostatic energies.</p>
<img src="figures/4g.png" width="800"/></section>
</section>
</section>
<section id="using-runner-via-the-pyiron-interface">
<h2>Using RuNNer via the pyiron Interface<a class="headerlink" href="#using-runner-via-the-pyiron-interface" title="Permalink to this heading">#</a></h2>
<p>In general, training a HDNNP with <strong>RuNNer</strong> can be separated into three different stages - so-called modes - in which different types of calculation are performed.</p>
<ul class="simple">
<li><p><strong>Mode 1:</strong> calculation of the SF values and separation of the dataset into a training and testing set.</p></li>
<li><p><strong>Mode 2:</strong> training of the model to construct the HDNNP.</p></li>
<li><p><strong>Mode 3:</strong> prediction of energy and forces (stress and charges can also be predicted).</p></li>
</ul>
<p>All these steps are performed consecutively beginning with mode 1.</p>
<section id="data-preparation">
<h3>Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this heading">#</a></h3>
<p>The creation of a meaningful neural network potential lives and dies with high quality training data. Therefore, we will begin by inspecting the full training dataset.
The dataset has been stored prior to the workshop in form of a <code class="docutils literal notranslate"><span class="pre">TrainingContainer</span></code>.
In pyiron, <code class="docutils literal notranslate"><span class="pre">TrainingContainer</span></code>s are jobs which take a set of structures and properties like energies, forces, … and store them in HDF format.</p>
<p>Go ahead and open up the project:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="s1">&#39;../../introduction/training&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The project already contains several jobs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr</span><span class="o">.</span><span class="n">job_table</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>status</th>
      <th>chemicalformula</th>
      <th>job</th>
      <th>subjob</th>
      <th>projectpath</th>
      <th>project</th>
      <th>timestart</th>
      <th>timestop</th>
      <th>totalcputime</th>
      <th>computer</th>
      <th>hamilton</th>
      <th>hamversion</th>
      <th>parentid</th>
      <th>masterid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>212</td>
      <td>finished</td>
      <td>None</td>
      <td>full</td>
      <td>/full</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/</td>
      <td>2022-06-03 00:02:34.816533</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>zora@cmti001#1</td>
      <td>TrainingContainer</td>
      <td>0.4</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>213</td>
      <td>finished</td>
      <td>None</td>
      <td>basic</td>
      <td>/basic</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/</td>
      <td>2022-06-03 00:02:47.281055</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>zora@cmti001#1</td>
      <td>TrainingContainer</td>
      <td>0.4</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>214</td>
      <td>finished</td>
      <td>None</td>
      <td>Al_basic_atomicrex</td>
      <td>/Al_basic_atomicrex</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/</td>
      <td>2022-06-03 02:00:15.887059</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>zora@cmti001#1</td>
      <td>TrainingContainer</td>
      <td>0.4</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>226</td>
      <td>finished</td>
      <td>None</td>
      <td>data_lithium</td>
      <td>/data_lithium</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/</td>
      <td>2022-07-21 08:18:19.193090</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>pyiron@lap2p#1</td>
      <td>TrainingContainer</td>
      <td>0.4</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>227</td>
      <td>finished</td>
      <td>None</td>
      <td>fit_mode1</td>
      <td>/fit_mode1</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/fit_lithium/</td>
      <td>2022-07-21 08:18:22.251691</td>
      <td>2022-07-21 08:18:28.328624</td>
      <td>6.0</td>
      <td>pyiron@lap2p#1</td>
      <td>RunnerFit</td>
      <td>0.4</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>228</td>
      <td>finished</td>
      <td>None</td>
      <td>fit_mode2</td>
      <td>/fit_mode2</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/fit_lithium/</td>
      <td>2022-07-21 08:18:30.158483</td>
      <td>2022-07-21 08:22:02.862973</td>
      <td>212.0</td>
      <td>pyiron@lap2p#1</td>
      <td>RunnerFit</td>
      <td>0.4</td>
      <td>227.0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>229</td>
      <td>finished</td>
      <td>None</td>
      <td>fit_mode3</td>
      <td>/fit_mode3</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/fit_lithium/</td>
      <td>2022-07-21 08:22:04.136475</td>
      <td>2022-07-21 08:22:11.189763</td>
      <td>7.0</td>
      <td>pyiron@lap2p#1</td>
      <td>RunnerFit</td>
      <td>0.4</td>
      <td>228.0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7</th>
      <td>230</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_3_0</td>
      <td>/job_a_3_0</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:12.207784</td>
      <td>2022-07-21 08:22:15.498472</td>
      <td>3.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>8</th>
      <td>231</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_3_167</td>
      <td>/job_a_3_167</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:15.639460</td>
      <td>2022-07-21 08:22:15.965042</td>
      <td>0.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>9</th>
      <td>232</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_3_333</td>
      <td>/job_a_3_333</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:16.102696</td>
      <td>2022-07-21 08:22:16.395679</td>
      <td>0.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>10</th>
      <td>233</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_3_5</td>
      <td>/job_a_3_5</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:16.572264</td>
      <td>2022-07-21 08:22:16.831195</td>
      <td>0.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>11</th>
      <td>234</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_3_667</td>
      <td>/job_a_3_667</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:16.975377</td>
      <td>2022-07-21 08:22:17.282200</td>
      <td>0.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>12</th>
      <td>235</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_3_833</td>
      <td>/job_a_3_833</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:17.434798</td>
      <td>2022-07-21 08:22:17.694902</td>
      <td>0.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>13</th>
      <td>236</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_4_0</td>
      <td>/job_a_4_0</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:17.828141</td>
      <td>2022-07-21 08:22:18.089258</td>
      <td>0.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The training data is stored in the project node <code class="docutils literal notranslate"><span class="pre">initial</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_full</span> <span class="o">=</span> <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;basic&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>In order to get a feeling for the data, we inspect its energy-volume curve:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">data_full</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">energy_volume</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5620ad1ea850b687ac9a93b2459e6e643ca643a1f7e5e54e7b50cf43d2cf5cdb.png" src="../../_images/5620ad1ea850b687ac9a93b2459e6e643ca643a1f7e5e54e7b50cf43d2cf5cdb.png" />
</div>
</div>
<p>As you can see in this plot, some regions of configuration space are much more densily sampled than others. The dataset consists of approximately 4000 structures, ranging from bulk lithium and aluminum to off-stochiometric liquid phases of LiAl alloy.</p>
<p>Training a potential for such a large dataset to high accuracy takes a few hours. Therefore, we are going to focus on a case study: the subset of pure lithium structures in the dataset.</p>
<p>We extract a sample from the full dataset using <code class="docutils literal notranslate"><span class="pre">TrainingContainer</span></code>s convenient <code class="docutils literal notranslate"><span class="pre">sample</span></code> function. It creates a new <code class="docutils literal notranslate"><span class="pre">TrainingContainer</span></code> job (here we give it the name <code class="docutils literal notranslate"><span class="pre">data_lithium</span></code>) using a simple filter function. The filter function will remove:</p>
<ul class="simple">
<li><p>structures that contain Al.</p></li>
<li><p>structures with a positive energy.</p></li>
<li><p>structures in which atoms do not have any neighbors within a cutoff radius of 12 Bohr.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">filter_lithium</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter a given `container` for the most useful lithium structures.&quot;&quot;&quot;</span>
    <span class="c1"># Get the elements, total energy and atomic positions.</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;symbols&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;positions&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

    <span class="c1"># Build the distance matrix.</span>
    <span class="n">distmatrix</span> <span class="o">=</span> <span class="n">get_distances</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">positions</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Check if every atom has at least one neighbor in a 12 Bohr = 6.35 Ang                                                                                                          </span>
    <span class="c1"># cutoff radius.</span>
    <span class="n">no_neighbors</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">distmatrix</span><span class="p">):</span>

        <span class="c1"># Remove self interaction.                                                                                                                                                        </span>
        <span class="n">row_no_selfinteraction</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">row</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">row_no_selfinteraction</span> <span class="o">&gt;</span> <span class="mf">6.35</span><span class="p">):</span>
            <span class="n">no_neighbors</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="k">return</span> <span class="s1">&#39;Al&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elements</span> <span class="ow">and</span> <span class="n">energy</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">no_neighbors</span> <span class="ow">is</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove the job if it already exists.</span>
<span class="k">if</span> <span class="s1">&#39;data_lithium&#39;</span> <span class="ow">in</span> <span class="n">pr</span><span class="o">.</span><span class="n">list_nodes</span><span class="p">():</span>
    <span class="n">pr</span><span class="o">.</span><span class="n">remove_job</span><span class="p">(</span><span class="s1">&#39;data_lithium&#39;</span><span class="p">)</span>

<span class="n">data_lithium</span> <span class="o">=</span> <span class="n">data_full</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s1">&#39;data_lithium&#39;</span><span class="p">,</span> <span class="n">filter_lithium</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DataContainer({&#39;save_neighbors&#39;: True, &#39;num_neighbors&#39;: 12})
The job data_lithium was saved and received the ID: 237
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data_lithium</span><span class="o">.</span><span class="n">iter_structures</span><span class="p">())))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>176
</pre></div>
</div>
</div>
</div>
<p>When inspecting the list of jobs in the project again, you will find that an additional <code class="docutils literal notranslate"><span class="pre">TrainingContainer</span></code> has been created.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr</span><span class="o">.</span><span class="n">job_table</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>status</th>
      <th>chemicalformula</th>
      <th>job</th>
      <th>subjob</th>
      <th>projectpath</th>
      <th>project</th>
      <th>timestart</th>
      <th>timestop</th>
      <th>totalcputime</th>
      <th>computer</th>
      <th>hamilton</th>
      <th>hamversion</th>
      <th>parentid</th>
      <th>masterid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>212</td>
      <td>finished</td>
      <td>None</td>
      <td>full</td>
      <td>/full</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/</td>
      <td>2022-06-03 00:02:34.816533</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>zora@cmti001#1</td>
      <td>TrainingContainer</td>
      <td>0.4</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>213</td>
      <td>finished</td>
      <td>None</td>
      <td>basic</td>
      <td>/basic</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/</td>
      <td>2022-06-03 00:02:47.281055</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>zora@cmti001#1</td>
      <td>TrainingContainer</td>
      <td>0.4</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>214</td>
      <td>finished</td>
      <td>None</td>
      <td>Al_basic_atomicrex</td>
      <td>/Al_basic_atomicrex</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/</td>
      <td>2022-06-03 02:00:15.887059</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>zora@cmti001#1</td>
      <td>TrainingContainer</td>
      <td>0.4</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>227</td>
      <td>finished</td>
      <td>None</td>
      <td>fit_mode1</td>
      <td>/fit_mode1</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/fit_lithium/</td>
      <td>2022-07-21 08:18:22.251691</td>
      <td>2022-07-21 08:18:28.328624</td>
      <td>6.0</td>
      <td>pyiron@lap2p#1</td>
      <td>RunnerFit</td>
      <td>0.4</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>228</td>
      <td>finished</td>
      <td>None</td>
      <td>fit_mode2</td>
      <td>/fit_mode2</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/fit_lithium/</td>
      <td>2022-07-21 08:18:30.158483</td>
      <td>2022-07-21 08:22:02.862973</td>
      <td>212.0</td>
      <td>pyiron@lap2p#1</td>
      <td>RunnerFit</td>
      <td>0.4</td>
      <td>227.0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>229</td>
      <td>finished</td>
      <td>None</td>
      <td>fit_mode3</td>
      <td>/fit_mode3</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/fit_lithium/</td>
      <td>2022-07-21 08:22:04.136475</td>
      <td>2022-07-21 08:22:11.189763</td>
      <td>7.0</td>
      <td>pyiron@lap2p#1</td>
      <td>RunnerFit</td>
      <td>0.4</td>
      <td>228.0</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>230</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_3_0</td>
      <td>/job_a_3_0</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:12.207784</td>
      <td>2022-07-21 08:22:15.498472</td>
      <td>3.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7</th>
      <td>231</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_3_167</td>
      <td>/job_a_3_167</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:15.639460</td>
      <td>2022-07-21 08:22:15.965042</td>
      <td>0.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>8</th>
      <td>232</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_3_333</td>
      <td>/job_a_3_333</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:16.102696</td>
      <td>2022-07-21 08:22:16.395679</td>
      <td>0.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>9</th>
      <td>233</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_3_5</td>
      <td>/job_a_3_5</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:16.572264</td>
      <td>2022-07-21 08:22:16.831195</td>
      <td>0.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>10</th>
      <td>234</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_3_667</td>
      <td>/job_a_3_667</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:16.975377</td>
      <td>2022-07-21 08:22:17.282200</td>
      <td>0.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>11</th>
      <td>235</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_3_833</td>
      <td>/job_a_3_833</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:17.434798</td>
      <td>2022-07-21 08:22:17.694902</td>
      <td>0.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>12</th>
      <td>236</td>
      <td>finished</td>
      <td>Li</td>
      <td>job_a_4_0</td>
      <td>/job_a_4_0</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/E_V_curve/</td>
      <td>2022-07-21 08:22:17.828141</td>
      <td>2022-07-21 08:22:18.089258</td>
      <td>0.0</td>
      <td>pyiron@lap2p#1</td>
      <td>Lammps</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>13</th>
      <td>237</td>
      <td>finished</td>
      <td>None</td>
      <td>data_lithium</td>
      <td>/data_lithium</td>
      <td>None</td>
      <td>/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/</td>
      <td>2022-07-21 08:24:51.905888</td>
      <td>NaT</td>
      <td>NaN</td>
      <td>pyiron@lap2p#1</td>
      <td>TrainingContainer</td>
      <td>0.4</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>For comparison, here is the energy-volume curve from before, overlayed with the structures in the reduced dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">data_full</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">energy_volume</span><span class="p">()</span>
<span class="n">data_lithium</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">energy_volume</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Full dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;Lithium&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b339a45c823589834948556540228291583ced78a5ed8ab707fd3dda1086f4b0.png" src="../../_images/b339a45c823589834948556540228291583ced78a5ed8ab707fd3dda1086f4b0.png" />
</div>
</div>
<p>As you can see, we have selected a very small part of the dataset for our demonstration (176 of ~4000 structures). Nevertheless, the following chapters will demonstrate all the relevant RuNNer concepts to create a similar potential with more training data.</p>
</section>
<section id="job-setup-runnerfit">
<h3>Job Setup: <code class="docutils literal notranslate"><span class="pre">RunnerFit</span></code><a class="headerlink" href="#job-setup-runnerfit" title="Permalink to this heading">#</a></h3>
<p>pyiron and the RuNNer Fortran program communicate via a custom job type called <code class="docutils literal notranslate"><span class="pre">RunnerFit</span></code>. Here, we add a new job to the project via <code class="docutils literal notranslate"><span class="pre">create_job</span></code> and give it the name <code class="docutils literal notranslate"><span class="pre">fit_data_lithium</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_fit</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;fit_lithium&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mode1</span> <span class="o">=</span> <span class="n">pr_fit</span><span class="o">.</span><span class="n">create</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">RunnerFit</span><span class="p">(</span><span class="s1">&#39;fit_mode1&#39;</span><span class="p">,</span> <span class="n">delete_existing_job</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Every <code class="docutils literal notranslate"><span class="pre">RunnerFit</span></code> job is initialized with a sensible choice of input parameters for RuNNer (<code class="docutils literal notranslate"><span class="pre">parameters</span></code>) and an empty storage for training structures (<code class="docutils literal notranslate"><span class="pre">training_data</span></code>). This information can easily be accessed through the <code class="docutils literal notranslate"><span class="pre">input</span></code> property.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mode1</span><span class="o">.</span><span class="n">input</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>DataContainer({
  "parameters": {
    "runner_mode": "1",
    "symfunction_short": "[]",
    "elements": "None",
    "number_of_elements": "0",
    "bond_threshold": "0.5",
    "nn_type_short": "1",
    "use_short_nn": "True",
    "optmode_charge": "1",
    "optmode_short_energy": "1",
    "optmode_short_force": "1",
    "points_in_memory": "1000",
    "scale_symmetry_functions": "True",
    "cutoff_type": "1",
    "test_fraction": "0.1",
    "use_short_forces": "True",
    "epochs": "30",
    "kalman_lambda_short": "0.98",
    "kalman_nue_short": "0.9987",
    "mix_all_points": "True",
    "nguyen_widrow_weights_short": "True",
    "repeated_energy_update": "True",
    "short_energy_error_threshold": "0.1",
    "short_energy_fraction": "1.0",
    "short_force_error_threshold": "1.0",
    "short_force_fraction": "0.1",
    "use_old_weights_charge": "False",
    "use_old_weights_short": "False",
    "write_weights_epoch": "5",
    "center_symmetry_functions": "True",
    "precondition_weights": "True",
    "global_activation_short": "[['t', 't', 'l']]",
    "global_hidden_layers_short": "2",
    "global_nodes_short": "[[15, 15]]"
  },
  "training_data": "<pyiron_contrib.atomistics.atomistics.job.trainingcontainer.TrainingStorage object at 0x7ff3c9504460>"
})</pre></div></div>
</div>
<p>Here, we will only explain the global keywords which are relevant for all modes. The remaining keywords will be explained in following chapters. If a keyword is not specified on the pyiron-side, the <strong>RuNNer</strong> Fortran program uses default values, if possible.
For a more detailed explanation of all RuNNer keywords, take a look at <a class="reference external" href="https://theochemgoettingen.gitlab.io/RuNNer">the RuNNer documentation</a>.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Keyword</p></th>
<th class="head"><p>Default</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>runner_mode</p></td>
<td><p>1</p></td>
<td class="text-left"><p>Choose the operating mode of RuNNer.</p></td>
</tr>
<tr class="row-odd"><td><p>symfunction_short</p></td>
<td><p>empty <code class="docutils literal notranslate"><span class="pre">SymmetryFunctionSet</span></code></p></td>
<td class="text-left"><p>Specification of the symmetry functions for a specific element with a specific neighbor element combination for the short-range NN.</p></td>
</tr>
<tr class="row-even"><td><p>elements</p></td>
<td><p>None</p></td>
<td class="text-left"><p>The element symbols of all elements in the system in arbitrary order. The number of specified elements must fit to the value of the keyword number_of_elements. Will be automatically set by <code class="docutils literal notranslate"><span class="pre">pyiron</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p>number_of_elements</p></td>
<td><p>0</p></td>
<td class="text-left"><p>Specify the number of chemical elements in the system. Will be automatically set by <code class="docutils literal notranslate"><span class="pre">pyiron</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p>bond_threshold</p></td>
<td><p>0.5</p></td>
<td class="text-left"><p>Threshold for the shortest bond in the structure in Bohr units. If a shorter bond occurs RuNNer will stop with an error message in runner_mode 2 and 3. In runner_mode 1 the structure will be eliminated from the data set.</p></td>
</tr>
<tr class="row-odd"><td><p>nn_type_short</p></td>
<td><p>1</p></td>
<td class="text-left"><p>Specify the NN type of the short-range part (atomic or pair-based energy expression).</p></td>
</tr>
<tr class="row-even"><td><p>use_short_nn</p></td>
<td><p>True</p></td>
<td class="text-left"><p>Use the a short range NN.</p></td>
</tr>
<tr class="row-odd"><td><p>points_in_memory</p></td>
<td><p>1000</p></td>
<td class="text-left"><p>This keyword controls memory consumption and IO and is therefore important to achieve an optimum performance of RuNNer. Has a different meaning depending on the current runner_mode.</p></td>
</tr>
<tr class="row-even"><td><p>use_short_forces</p></td>
<td><p>True</p></td>
<td class="text-left"><p>Use forces for fitting the short range NN weights.</p></td>
</tr>
</tbody>
</table>
<section id="adding-training-data">
<h4>Adding Training Data<a class="headerlink" href="#adding-training-data" title="Permalink to this heading">#</a></h4>
<p>As of yet, this job does not have a training dataset. However, as you already saw for the EAM potential, adding a new training dataset to the job is as simple as calling <code class="docutils literal notranslate"><span class="pre">add_training_data</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The if-conditions prevents you from accidentally adding the same</span>
<span class="c1"># structures twice to the training dataset.</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mode1</span><span class="o">.</span><span class="n">training_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">mode1</span><span class="o">.</span><span class="n">add_training_data</span><span class="p">(</span><span class="n">data_lithium</span><span class="p">)</span>

<span class="nb">len</span><span class="p">(</span><span class="n">mode1</span><span class="o">.</span><span class="n">training_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>176
</pre></div>
</div>
</div>
</div>
<p>By calling <code class="docutils literal notranslate"><span class="pre">add_training_data</span></code> multiple times, it is very easy to combine several independent training datasets for one fit.</p>
</section>
<section id="specification-of-runner-parameters">
<h4>Specification of RuNNer Parameters<a class="headerlink" href="#specification-of-runner-parameters" title="Permalink to this heading">#</a></h4>
<p>While many of the default parameters in <code class="docutils literal notranslate"><span class="pre">RunnerFit</span></code> are suited for a wide range of calculations, you still need to carefully check each of them before starting a fit. Special attention must be given to the atom-centered symmetry functions as they have to be tailored to the system under investigation.</p>
</section>
<section id="generating-sfs-with-runnerase">
<h4>Generating SFs with <code class="docutils literal notranslate"><span class="pre">runnerase</span></code><a class="headerlink" href="#generating-sfs-with-runnerase" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">RunnerFit</span></code> builds on the RuNNer ASE interface which is publicly available as <code class="docutils literal notranslate"><span class="pre">runnerase</span></code>. For further information check out the <a class="reference external" href="https://runner-suite.gitlab.io/runnerase">runnerase documentation</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">runnerase</span></code> provides a <code class="docutils literal notranslate"><span class="pre">generate_symmetryfunction</span></code> procedure, which makes it easy to tailor SFs to the corresponding training dataset. You can either generate radial SFs by setting <code class="docutils literal notranslate"><span class="pre">sftype=2</span></code>, or angular SFs with <code class="docutils literal notranslate"><span class="pre">sftype=3</span></code>. The algorithm will then automatically generate one set of SFs for each pair or each triplet of elements in the dataset. The number of SFs per set can be specified with the <code class="docutils literal notranslate"><span class="pre">amount</span></code> argument. Finally, <code class="docutils literal notranslate"><span class="pre">generate_symmetryfunctions</span></code> comes with several different <code class="docutils literal notranslate"><span class="pre">algorithm</span></code>s for choosing the parameters of the SFs:</p>
<ul class="simple">
<li><p><strong>Radial SFs:</strong> One can choose from <code class="docutils literal notranslate"><span class="pre">algorithm=turn</span></code> and <code class="docutils literal notranslate"><span class="pre">algorithm=half</span></code>. <code class="docutils literal notranslate"><span class="pre">turn</span></code> will choose the SF coefficients such that the turning points of all SFs are equally spaced between the cutoff radius and the minimum distance between any given element pair. <code class="docutils literal notranslate"><span class="pre">half</span></code> will make sure that the SFs are equally spaced at <span class="math notranslate nohighlight">\(f(G) = 0.5\)</span>.</p></li>
<li><p><strong>Angular SFs:</strong> One can choose from <code class="docutils literal notranslate"><span class="pre">algorithm=turn</span></code>, <code class="docutils literal notranslate"><span class="pre">algorithm=half</span></code>, or <code class="docutils literal notranslate"><span class="pre">algorithm=literature</span></code>. While the first two algorithms behave similarly to the ones for radial SF, <code class="docutils literal notranslate"><span class="pre">literature</span></code> will return SF coefficients that have proven to be a reliable choice for most systems in previous publications.</p></li>
</ul>
<p>In most RuNNer-related publications, a combination of <code class="docutils literal notranslate"><span class="pre">algorithm=turn</span></code> for radial SFs and <code class="docutils literal notranslate"><span class="pre">algorithm=literature</span></code> for angular SFs has been used.</p>
<p>However, <code class="docutils literal notranslate"><span class="pre">runnerase</span></code> does not operate on pyiron objects like the <code class="docutils literal notranslate"><span class="pre">TrainingContainer</span></code>. Therefore, we transform the <code class="docutils literal notranslate"><span class="pre">TrainingContainer</span></code> with our lithium structures into a List of ASE Atoms objects. The <code class="docutils literal notranslate"><span class="pre">container_to_ase</span></code> function is defined in pyiron_contrib.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">container_to_ase</span><span class="p">(</span><span class="n">data_lithium</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In the following, we have prepared two interactive plotting functions for you, so you can try out different parameters for the SFs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">algorithm</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;turn&#39;</span><span class="p">,</span> <span class="s1">&#39;half&#39;</span><span class="p">],</span>
                  <span class="n">cutoff_function</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="n">show_legend</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;turn&#39;</span><span class="p">,</span> <span class="n">cutoff_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># Clear the plot.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    
    <span class="c1"># Generate the symmetry functions.</span>
    <span class="n">radials</span> <span class="o">=</span> <span class="n">generate_symmetryfunctions</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">sftype</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">,</span>
                                         <span class="n">cutoff</span><span class="o">=</span><span class="mf">12.0</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">)</span>
    <span class="n">radials</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">radial</span><span class="p">(</span><span class="n">cutoff_function</span><span class="o">=</span><span class="n">cutoff_function</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="n">show_legend</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a16558439a0c451d8e6fea4a851c3607", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">algorithm</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;half&#39;</span><span class="p">,</span> <span class="s1">&#39;turn&#39;</span><span class="p">,</span> <span class="s1">&#39;literature&#39;</span><span class="p">],</span>
                  <span class="n">show_legend</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">amount</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;literature&#39;</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">angulars</span> <span class="o">=</span> <span class="n">generate_symmetryfunctions</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">sftype</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span>
                                          <span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">12.0</span><span class="p">)</span>
    <span class="n">angulars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">angular</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="n">show_legend</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "10565efc82154d67bcdad4d31fc3ac29", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="adding-sfs-to-the-job">
<h4>Adding SFs to the Job<a class="headerlink" href="#adding-sfs-to-the-job" title="Permalink to this heading">#</a></h4>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">mode1.parameters.symfunction_short</span></code> is, in fact, a so-called <code class="docutils literal notranslate"><span class="pre">SymmetryFunctionSet</span></code> object. They function similar to a folder: you can either store <code class="docutils literal notranslate"><span class="pre">SymmetryFunction</span></code> objects directly (= a file), or create more <code class="docutils literal notranslate"><span class="pre">SymmetryFunctionSet</span></code>s in them (= another folder).</p>
<p>When <code class="docutils literal notranslate"><span class="pre">generate_symmetryfunctions</span></code> is called, it returns a <code class="docutils literal notranslate"><span class="pre">SymmetryFunctionSet</span></code> itself. Two <code class="docutils literal notranslate"><span class="pre">SymmetryFunctionSet</span></code>s can easily be combined using the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator. This way, we can add a collection of radial symmetry functions to our job.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reset the symmetry function container.</span>
<span class="n">mode1</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">symfunction_short</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="c1"># Generate radial symmetry functions.</span>
<span class="n">radials</span> <span class="o">=</span> <span class="n">generate_symmetryfunctions</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">sftype</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;half&#39;</span><span class="p">,</span>
                                     <span class="n">cutoff</span><span class="o">=</span><span class="mf">12.0</span><span class="p">)</span>

<span class="n">mode1</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">symfunction_short</span> <span class="o">+=</span> <span class="n">radials</span>
</pre></div>
</div>
</div>
</div>
<p>All SFs stored in <code class="docutils literal notranslate"><span class="pre">radials</span></code> can be accessed through its <code class="docutils literal notranslate"><span class="pre">storage</span></code> property. As you can see, <code class="docutils literal notranslate"><span class="pre">radials</span></code> essentially organizes a list of SFs in a convenient storage format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">radials</span><span class="o">.</span><span class="n">storage</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[SymmetryFunction(sftype=2, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;], coefficients=[0.0, 0.0]),
 SymmetryFunction(sftype=2, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;], coefficients=[0.004675055980246072, 0.0]),
 SymmetryFunction(sftype=2, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;], coefficients=[0.010843416275634649, 0.0]),
 SymmetryFunction(sftype=2, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;], coefficients=[0.01939424193215976, 0.0]),
 SymmetryFunction(sftype=2, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;], coefficients=[0.03192971575337408, 0.0]),
 SymmetryFunction(sftype=2, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;], coefficients=[0.05159916711157465, 0.0])]
</pre></div>
</div>
</div>
</div>
<p>Similarly, we can generate a set of angular symmetry functions and add them to the job as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate angular symmetry functions.                                                                                                                                                                                                                        </span>
<span class="n">angulars</span> <span class="o">=</span> <span class="n">generate_symmetryfunctions</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">sftype</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                      <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;literature&#39;</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">12.0</span><span class="p">)</span>

<span class="n">mode1</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">symfunction_short</span> <span class="o">+=</span> <span class="n">angulars</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">angulars</span><span class="o">.</span><span class="n">storage</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[SymmetryFunction(sftype=3, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;, &#39;Li&#39;], coefficients=[0.0, -1.0, 1]),
 SymmetryFunction(sftype=3, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;, &#39;Li&#39;], coefficients=[0.0, -1.0, 2]),
 SymmetryFunction(sftype=3, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;, &#39;Li&#39;], coefficients=[0.0, -1.0, 4]),
 SymmetryFunction(sftype=3, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;, &#39;Li&#39;], coefficients=[0.0, -1.0, 8]),
 SymmetryFunction(sftype=3, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;, &#39;Li&#39;], coefficients=[0.0, 1.0, 1]),
 SymmetryFunction(sftype=3, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;, &#39;Li&#39;], coefficients=[0.0, 1.0, 2]),
 SymmetryFunction(sftype=3, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;, &#39;Li&#39;], coefficients=[0.0, 1.0, 4]),
 SymmetryFunction(sftype=3, cutoff=12.0, elements=[&#39;Li&#39;, &#39;Li&#39;, &#39;Li&#39;], coefficients=[0.0, 1.0, 8])]
</pre></div>
</div>
</div>
</div>
<p>When we look at the <code class="docutils literal notranslate"><span class="pre">input</span></code> of the job again, you will find that all symmetry functions appear.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mode1</span><span class="o">.</span><span class="n">input</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>DataContainer({
  "parameters": {
    "runner_mode": "1",
    "symfunction_short": "[('Li', 2, 'Li', 0.0, 0.0, 12.0), ('Li', 2, 'Li', 0.004675055980246072, 0.0, 12.0), ('Li', 2, 'Li', 0.010843416275634649, 0.0, 12.0), ('Li', 2, 'Li', 0.01939424193215976, 0.0, 12.0), ('Li', 2, 'Li', 0.03192971575337408, 0.0, 12.0), ('Li', 2, 'Li', 0.05159916711157465, 0.0, 12.0), ('Li', 3, 'Li', 'Li', 0.0, -1.0, 1, 12.0), ('Li', 3, 'Li', 'Li', 0.0, -1.0, 2, 12.0), ('Li', 3, 'Li', 'Li', 0.0, -1.0, 4, 12.0), ('Li', 3, 'Li', 'Li', 0.0, -1.0, 8, 12.0), ('Li', 3, 'Li', 'Li', 0.0, 1.0, 1, 12.0), ('Li', 3, 'Li', 'Li', 0.0, 1.0, 2, 12.0), ('Li', 3, 'Li', 'Li', 0.0, 1.0, 4, 12.0), ('Li', 3, 'Li', 'Li', 0.0, 1.0, 8, 12.0)]",
    "elements": "None",
    "number_of_elements": "0",
    "bond_threshold": "0.5",
    "nn_type_short": "1",
    "use_short_nn": "True",
    "optmode_charge": "1",
    "optmode_short_energy": "1",
    "optmode_short_force": "1",
    "points_in_memory": "1000",
    "scale_symmetry_functions": "True",
    "cutoff_type": "1",
    "test_fraction": "0.1",
    "use_short_forces": "True",
    "epochs": "30",
    "kalman_lambda_short": "0.98",
    "kalman_nue_short": "0.9987",
    "mix_all_points": "True",
    "nguyen_widrow_weights_short": "True",
    "repeated_energy_update": "True",
    "short_energy_error_threshold": "0.1",
    "short_energy_fraction": "1.0",
    "short_force_error_threshold": "1.0",
    "short_force_fraction": "0.1",
    "use_old_weights_charge": "False",
    "use_old_weights_short": "False",
    "write_weights_epoch": "5",
    "center_symmetry_functions": "True",
    "precondition_weights": "True",
    "global_activation_short": "[['t', 't', 'l']]",
    "global_hidden_layers_short": "2",
    "global_nodes_short": "[[15, 15]]"
  },
  "training_data": "<pyiron_contrib.atomistics.atomistics.job.trainingcontainer.TrainingStorage object at 0x7ff3c9504460>"
})</pre></div></div>
</div>
</section>
</section>
<section id="mode-1-calculation-of-sf-values">
<h3>Mode 1: Calculation of SF Values<a class="headerlink" href="#mode-1-calculation-of-sf-values" title="Permalink to this heading">#</a></h3>
<p>In <strong>RuNNer</strong>’s mode 1 the following steps are performed:</p>
<ul class="simple">
<li><p>calculation of SF values,</p></li>
<li><p>splitting of data set in train and test data set.</p></li>
</ul>
<p>The most important keywords for RuNNer mode 1 are summarized in the following table. Previously unmentioned keywords are marked in bold font.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Keyword</p></th>
<th class="head"><p>Default</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>runner_mode</p></td>
<td><p>1</p></td>
<td class="text-left"><p></p></td>
</tr>
<tr class="row-odd"><td><p>symfunction_short</p></td>
<td><p>empty <code class="docutils literal notranslate"><span class="pre">SymmetryFunctionSet</span></code></p></td>
<td class="text-left"><p>Specification of the symmetry functions for a specific element with a specific neighbor element combination for the short-range NN.</p></td>
</tr>
<tr class="row-even"><td><p>elements</p></td>
<td><p>None</p></td>
<td class="text-left"><p>The element symbols of all elements in the system in arbitrary order. The number of specified elements must fit to the value of the keyword number_of_elements.</p></td>
</tr>
<tr class="row-odd"><td><p>number_of_elements</p></td>
<td><p>0</p></td>
<td class="text-left"><p>Specify the number of chemical elements in the system.</p></td>
</tr>
<tr class="row-even"><td><p>points_in_memory</p></td>
<td><p>1000</p></td>
<td class="text-left"><p>This keyword controls memory consumption and IO and is therefore important to achieve an optimum performance of RuNNer. Has a different meaning depending on the current runner_mode.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>cutoff_type</strong></p></td>
<td><p>1</p></td>
<td class="text-left"><p>This keyword determines the cutoff function to be used for the symmetry functions.</p></td>
</tr>
<tr class="row-even"><td><p><strong>test_fraction</strong></p></td>
<td><p>0.1</p></td>
<td class="text-left"><p>Threshold for splitting between training and testing set in runner_mode 1.</p></td>
</tr>
<tr class="row-odd"><td><p>use_short_forces</p></td>
<td><p>True</p></td>
<td class="text-left"><p>Use forces for fitting the short range NN weights.</p></td>
</tr>
<tr class="row-even"><td><p><strong>random_seed</strong></p></td>
<td><p>None</p></td>
<td class="text-left"><p>The seed for ensuring reproducible results. Will be chosen automatically by pyiron if none was supplied.</p></td>
</tr>
</tbody>
</table>
<p>Finally, starting mode 1 is as simple as calling the <code class="docutils literal notranslate"><span class="pre">run</span></code> function. For safety, we reset the <code class="docutils literal notranslate"><span class="pre">runner_mode</span></code> parameter to 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run Mode 1.</span>
<span class="n">mode1</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">runner_mode</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mode1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">delete_existing_job</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DataContainer({&#39;parameters&#39;: DataContainer({&#39;runner_mode&#39;: 1, &#39;elements&#39;: None, &#39;number_of_elements&#39;: 0, &#39;bond_threshold&#39;: 0.5, &#39;nn_type_short&#39;: 1, &#39;use_short_nn&#39;: True, &#39;optmode_charge&#39;: 1, &#39;optmode_short_energy&#39;: 1, &#39;optmode_short_force&#39;: 1, &#39;points_in_memory&#39;: 1000, &#39;scale_symmetry_functions&#39;: True, &#39;cutoff_type&#39;: 1, &#39;test_fraction&#39;: 0.1, &#39;use_short_forces&#39;: True, &#39;epochs&#39;: 30, &#39;kalman_lambda_short&#39;: 0.98, &#39;kalman_nue_short&#39;: 0.9987, &#39;mix_all_points&#39;: True, &#39;nguyen_widrow_weights_short&#39;: True, &#39;repeated_energy_update&#39;: True, &#39;short_energy_error_threshold&#39;: 0.1, &#39;short_energy_fraction&#39;: 1.0, &#39;short_force_error_threshold&#39;: 1.0, &#39;short_force_fraction&#39;: 0.1, &#39;use_old_weights_charge&#39;: False, &#39;use_old_weights_short&#39;: False, &#39;write_weights_epoch&#39;: 5, &#39;center_symmetry_functions&#39;: True, &#39;precondition_weights&#39;: True, &#39;global_activation_short&#39;: [[&#39;t&#39;, &#39;t&#39;, &#39;l&#39;]], &#39;global_hidden_layers_short&#39;: 2, &#39;global_nodes_short&#39;: [[15, 15]], &#39;symfunction_short&#39;: [(&#39;Li&#39;, 2, &#39;Li&#39;, 0.0, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.004675055980246072, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.010843416275634649, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.01939424193215976, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.03192971575337408, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.05159916711157465, 0.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, -1.0, 1, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, -1.0, 2, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, -1.0, 4, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, -1.0, 8, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, 1.0, 1, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, 1.0, 2, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, 1.0, 4, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, 1.0, 8, 12.0)]}), &#39;training_data&#39;: &lt;pyiron_contrib.atomistics.atomistics.job.trainingcontainer.TrainingStorage object at 0x7ff3c9504460&gt;})
The job fit_mode1 was saved and received the ID: 238
</pre></div>
</div>
</div>
</div>
<p>The output of the calculation is stored in the <code class="docutils literal notranslate"><span class="pre">output</span></code> property of the job.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mode1</span><span class="o">.</span><span class="n">output</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>DataContainer({
  "sfvalues": "<pyiron_contrib.atomistics.runner.storageclasses.HDFSymmetryFunctionValues object at 0x7ff3c72def20>",
  "splittraintest": "HDFSplitTrainTest(n_train=159, n_test=17)"
})</pre></div></div>
</div>
<p>As you can see, <code class="docutils literal notranslate"><span class="pre">output</span></code> is a <code class="docutils literal notranslate"><span class="pre">DataContainer</span></code> with two nodes: the calculated SF values (<code class="docutils literal notranslate"><span class="pre">sfvalues</span></code>) and the split between training and testing data (<code class="docutils literal notranslate"><span class="pre">splittraintest</span></code>). The data is encapsulated in corresponding objects, e.g. <code class="docutils literal notranslate"><span class="pre">HDFSplitTrainTest</span></code>.</p>
<p><em>For those who are interested: the object <code class="docutils literal notranslate"><span class="pre">HDFSplitTraintTest</span></code> wraps a similar object that is provided by the runnerase package (<code class="docutils literal notranslate"><span class="pre">RunnerSplitTrainTest</span></code>). This is necessary to provide the runnerase object with the capabilities to read and write itself to and from HDF format. Apart from these additional functions, the two classes behave completely the same. All output values of the RunnerFit job are stored in this way. <code class="docutils literal notranslate"><span class="pre">HDFSymmetryFunctionValues</span></code> is an exception: because SF values are very large, they are stored on the pyiron-side in a flat storage array. Therefore, <code class="docutils literal notranslate"><span class="pre">HDFSymmetryFunctionValues</span></code> and <code class="docutils literal notranslate"><span class="pre">RunnerSymmetryFunctionValues</span></code> behave differently. In order to work with <code class="docutils literal notranslate"><span class="pre">HDFSymmetryFunctionValues</span></code> more conveniently, we therefore convert it back to the <code class="docutils literal notranslate"><span class="pre">RunnerSymmetryFunctionValues</span></code> class by calling its <code class="docutils literal notranslate"><span class="pre">to_runnerase</span></code> routine.</em></p>
<p>We store the two different output values in variables and access their plotting interfaces.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">split</span> <span class="o">=</span> <span class="n">mode1</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;splittraintest&#39;</span><span class="p">]</span>
<span class="n">sfvalues</span> <span class="o">=</span> <span class="n">mode1</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;sfvalues&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_runnerase</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">split</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/632b121616ddb9cd096c97db75ea76d76f84adf9929b14b855acedf522de54b3.png" src="../../_images/632b121616ddb9cd096c97db75ea76d76f84adf9929b14b855acedf522de54b3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sfvalues</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">boxplot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a9b8e8eb43e156f5013945579881112b6f5fa51c9f7bdf72223fc3573f94ee09.png" src="../../_images/a9b8e8eb43e156f5013945579881112b6f5fa51c9f7bdf72223fc3573f94ee09.png" />
</div>
</div>
<p>The boxplot above shows the distribution of SF values in the entire dataset for each SF. Outliers are depicted with black kites and every point corresponds to one atom.</p>
<p>This plot can give clues about outliers in the datatset which are difficult to fit. For example, symmetry function 7 shows very large values for one atom. This could indicate, that two atoms are getting unreasonably close (for radial SFs) or that their angle is very narrow (for angular SFs). Investigating such structures and, if necessary, removing them from the training dataset, can often improve a fit.</p>
</section>
<section id="mode-2-potential-training">
<h3>Mode 2: Potential Training<a class="headerlink" href="#mode-2-potential-training" title="Permalink to this heading">#</a></h3>
<p>In <code class="docutils literal notranslate"><span class="pre">mode</span> <span class="pre">2</span></code>, the magic happens and your data will be fitted. Again, we summarize important keywords in a table. There are many other keywords which allow you to finetune your potential. However, the selection below should give you many possibilities to change the outcome of the training process.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Keyword</p></th>
<th class="head"><p>Default</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>runner_mode</p></td>
<td><p>1</p></td>
<td class="text-left"><p>Must be set to 2.</p></td>
</tr>
<tr class="row-odd"><td><p>nn_type_short</p></td>
<td><p>1</p></td>
<td class="text-left"><p>Specify the NN type of the short-range part.</p></td>
</tr>
<tr class="row-even"><td><p>use_short_nn</p></td>
<td><p>True</p></td>
<td class="text-left"><p>Use the a short range NN. Whether an atomic or pair-based energy expression is used is determined via the keyword nn_type_short.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>optmode_short_energy</strong></p></td>
<td><p>1</p></td>
<td class="text-left"><p>Specify the optimization algorithm for the short-range energy contributions.</p></td>
</tr>
<tr class="row-even"><td><p><strong>optmode_short_force</strong></p></td>
<td><p>1</p></td>
<td class="text-left"><p>Specify the optimization algorithm for the short-range forces.</p></td>
</tr>
<tr class="row-odd"><td><p>points_in_memory</p></td>
<td><p>1000</p></td>
<td class="text-left"><p>This keyword controls memory consumption and IO and is therefore important to achieve an optimum performance of RuNNer. Has a different meaning depending on the current runner_mode.</p></td>
</tr>
<tr class="row-even"><td><p><strong>scale_symmetry_functions</strong></p></td>
<td><p>True</p></td>
<td class="text-left"><p>Rescale symmetry functions to a certain interval (the default interval is 0 to 1). This has numerical advantages if the orders of magnitudes of different symmetry functions are very different. If the minimum and maximum value for a symmetry function is the same for all structures, rescaling is not possible and RuNNer will terminate with an error. The interval can be specified by the keywords</p></td>
</tr>
<tr class="row-odd"><td><p>use_short_forces</p></td>
<td><p>True</p></td>
<td class="text-left"><p>Use forces for fitting the short range NN weights.</p></td>
</tr>
<tr class="row-even"><td><p><strong>epochs</strong></p></td>
<td><p>30</p></td>
<td class="text-left"><p>The number of epochs for fitting. If 0 is specified, RuNNer will calculate the error and terminate without adjusting weights.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>kalman_lambda_short</strong></p></td>
<td><p>0.98</p></td>
<td class="text-left"><p>Kalman filter parameter <span class="math notranslate nohighlight">\(\lambda\)</span> for the short range NN weight updates.</p></td>
</tr>
<tr class="row-even"><td><p><strong>kalman_nue_short</strong></p></td>
<td><p>0.9987</p></td>
<td class="text-left"><p>Kalman filter parameter <span class="math notranslate nohighlight">\(\nu\)</span> for the short range weight updates.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>mix_all_points</strong></p></td>
<td><p>True</p></td>
<td class="text-left"><p>Randomly reorder the data points in the data set at the beginning of each new epoch.</p></td>
</tr>
<tr class="row-even"><td><p><strong>nguyen_widrow_weights_short</strong></p></td>
<td><p>True</p></td>
<td class="text-left"><p>Initialize the short-range NN weights according to the scheme proposed by Nguyen and Widrow. The initial weights and bias values in the hidden layer are chosen such that the input space is evenly distributed over the nodes. This may speed up the training process.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>repeated_energy_update</strong></p></td>
<td><p>True</p></td>
<td class="text-left"><p>If this keyword is set, the weights of the short-range NN are updated a second time after the force update with respect to the total energies in the data set. This usually results in a more accurate potential energy fitting at the cost of slightly detiorated forces.</p></td>
</tr>
<tr class="row-even"><td><p><strong>center_symmetry_functions</strong></p></td>
<td><p>True</p></td>
<td class="text-left"><p>Shift the symmetry function values individually for each symmetry function such that the average is moved to zero. This may have numerical advantages, because zero is the center of the non-linear regions of most activation functions.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>precondition_weights</strong></p></td>
<td><p>True</p></td>
<td class="text-left"><p>Shift the weights of the atomic NNs right after the initialization so that the standard deviation of the NN energies is the same as the standard deviation of the reference energies.</p></td>
</tr>
<tr class="row-even"><td><p><strong>global_activation_short</strong></p></td>
<td><p>[[‘t’ ‘t’ ‘l’]]</p></td>
<td class="text-left"><p>Set the activation function for each hidden layer and the output layer in the short range NNs of all elements.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>global_hidden_layers_short</strong></p></td>
<td><p>2</p></td>
<td class="text-left"><p>Set the default number of hidden layers in the short-range NNs of all elements. Internally 1 is added to maxnum_layers_short, which also includes the output layer.</p></td>
</tr>
<tr class="row-even"><td><p><strong>global_nodes_short</strong></p></td>
<td><p>[[15 15]]</p></td>
<td class="text-left"><p>Set the default number of nodes in the hidden layers of the short-range NNs in case of nn_type_short 1. In the array, the entries 1 - maxnum_layersshort - 1 refer to the hidden layers. The first entry (0) refers to the nodes in the input layer and is determined automatically from the symmetry functions.</p></td>
</tr>
</tbody>
</table>
<p>During the fitting process of the NN, the error function <span class="math notranslate nohighlight">\(\Gamma\)</span> is minimized, which is defined as</p>
<p>\begin{equation}
\Gamma = \mathrm{RMSE}(E)=\frac{1}{N_\mathrm{struct}} \sum_{i}^{N_\mathrm{\mathrm{struct}}} (E_{\mathrm{NN}}^{i} - E_{\mathrm{ref}}^{i})^2,
\end{equation}</p>
<p>if only energy fitting is used, which defines simultaneously the root-mean squared error of the energies <span class="math notranslate nohighlight">\(\mathrm{RMSE}(E)\)</span>. This defines the differences of the reference data and the NNP predictions.</p>
<p>In order to run mode 2, we will restart the previous calculation, thereby creating a new job with its own folder structure. This way, we can try different combinations of parameters without overwriting any of the previous results.</p>
<p>Moreover, we will change some of the default parameters of the job. We reduce the number of epochs to 15 to keep the runtime short for this tutorial. Apart from that, we turn on force fitting (<code class="docutils literal notranslate"><span class="pre">use_short_forces=True</span></code>). This is turned off by default as force fitting is much more computationally demanding than pure energy fitting.</p>
<p>The next cell will run a few minutes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run Mode 2.</span>
<span class="n">mode2</span> <span class="o">=</span> <span class="n">mode1</span><span class="o">.</span><span class="n">restart</span><span class="p">(</span><span class="s1">&#39;fit_mode2&#39;</span><span class="p">)</span>
<span class="n">mode2</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">runner_mode</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">mode2</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">mode2</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">use_short_forces</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">mode2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">delete_existing_job</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DataContainer({&#39;parameters&#39;: DataContainer({&#39;runner_mode&#39;: 2, &#39;elements&#39;: None, &#39;number_of_elements&#39;: 0, &#39;bond_threshold&#39;: 0.5, &#39;nn_type_short&#39;: 1, &#39;use_short_nn&#39;: 1, &#39;optmode_charge&#39;: 1, &#39;optmode_short_energy&#39;: 1, &#39;optmode_short_force&#39;: 1, &#39;points_in_memory&#39;: 1000, &#39;scale_symmetry_functions&#39;: 1, &#39;cutoff_type&#39;: 1, &#39;test_fraction&#39;: 0.1, &#39;use_short_forces&#39;: True, &#39;epochs&#39;: 15, &#39;kalman_lambda_short&#39;: 0.98, &#39;kalman_nue_short&#39;: 0.9987, &#39;mix_all_points&#39;: 1, &#39;nguyen_widrow_weights_short&#39;: 1, &#39;repeated_energy_update&#39;: 1, &#39;short_energy_error_threshold&#39;: 0.1, &#39;short_energy_fraction&#39;: 1.0, &#39;short_force_error_threshold&#39;: 1.0, &#39;short_force_fraction&#39;: 0.1, &#39;use_old_weights_charge&#39;: 0, &#39;use_old_weights_short&#39;: 0, &#39;write_weights_epoch&#39;: 5, &#39;center_symmetry_functions&#39;: 1, &#39;precondition_weights&#39;: 1, &#39;global_activation_short&#39;: [[&#39;t&#39;, &#39;t&#39;, &#39;l&#39;]], &#39;global_hidden_layers_short&#39;: 2, &#39;global_nodes_short&#39;: [[15, 15]], &#39;symfunction_short&#39;: [(&#39;Li&#39;, 2, &#39;Li&#39;, 0.0, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.004675055980246072, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.010843416275634649, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.01939424193215976, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.03192971575337408, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.05159916711157465, 0.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, -1.0, 1.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, -1.0, 2.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, -1.0, 4.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, -1.0, 8.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, 1.0, 1.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, 1.0, 2.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, 1.0, 4.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, 1.0, 8.0, 12.0)]}), &#39;training_data&#39;: &lt;pyiron_contrib.atomistics.atomistics.job.trainingcontainer.TrainingStorage object at 0x7ff3c6db91b0&gt;})
The job fit_mode2 was saved and received the ID: 239
</pre></div>
</div>
</div>
</div>
<p>After the job has finished, we can first take a look at the behaviour of the error function, i.e. the RMSE. The <code class="docutils literal notranslate"><span class="pre">output</span></code> of mode 2 consists of three properties: the results of the fitting process (<code class="docutils literal notranslate"><span class="pre">fitresults</span></code>), the optimized weights and the symmetry function scaling data for shifting to zero mean and unit variance (<code class="docutils literal notranslate"><span class="pre">scaling</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mode2</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;fitresults&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch | RMSE(E) / eV/atom  | RMSE(F) / eV/Bohr  |
=================================================
      |  Train   |  Test   |  Train   |  Test   |
-------------------------------------------------
    0 |  0.1355  |  0.1938 |  0.1403  |  0.1291 |
    1 |  0.0285  |  0.2956 |  0.0604  |  0.0515 |
    2 |  0.0147  |  0.2408 |  0.0548  |  0.0469 |
    3 |  0.0171  |  0.0410 |  0.0438  |  0.0373 |
    4 |  0.0158  |  0.0542 |  0.0360  |  0.0322 |
    5 |  0.0196  |  0.0065 |  0.0319  |  0.0288 | &lt;- Best Epoch
    6 |  0.0182  |  0.0290 |  0.0295  |  0.0273 |
    7 |  0.0048  |  0.2361 |  0.0281  |  0.0259 |
    8 |  0.0054  |  0.1001 |  0.0271  |  0.0255 |
    9 |  0.0048  |  0.1364 |  0.0265  |  0.0248 |
   10 |  0.0062  |  0.3651 |  0.0259  |  0.0241 |
   11 |  0.0038  |  0.2871 |  0.0254  |  0.0237 |
   12 |  0.0029  |  0.0764 |  0.0247  |  0.0230 |
   13 |  0.0033  |  0.0739 |  0.0243  |  0.0227 |
   14 |  0.0022  |  0.0977 |  0.0240  |  0.0224 |
   15 |  0.0021  |  0.1520 |  0.0235  |  0.0219 |
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">table</span></code> function already shows you that both the energy and force RMSE are declining. The best epoch is determined by the energy RMSE on the <strong>test</strong> set that is lowest.</p>
<p>A more accessible analysis can be obtained by looking at the plots of this data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">mode2</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;fitresults&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">rmse_e</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7ecc5b012bb8871e2de89e1d3bf79ae44bfea1319e443ca8cfda241a1666bb3b.png" src="../../_images/7ecc5b012bb8871e2de89e1d3bf79ae44bfea1319e443ca8cfda241a1666bb3b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">mode2</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;fitresults&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">rmse_f</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1cd2739cc3c6829bf6eec162e427538cb39880a40d92663a7cecb54497e9ba0a.png" src="../../_images/1cd2739cc3c6829bf6eec162e427538cb39880a40d92663a7cecb54497e9ba0a.png" />
</div>
</div>
<p>The RMSE of the test set is consistently lower than that of the training set. This is because we are using a very small test set including only 17 structures. In contrast to that, you could identify overfitting, if the train RMSE were much lower than the test RMSE.</p>
<p>Nevertheless, the RMSE is a rather strong reduction of the really complex potential energy surface (PES) and can only be understood as a rule of thumb for the quality of the NNP fit.</p>
</section>
<section id="mode-3-potential-evaluation">
<h3>Mode 3: Potential Evaluation<a class="headerlink" href="#mode-3-potential-evaluation" title="Permalink to this heading">#</a></h3>
<p><strong>RuNNer</strong> <code class="docutils literal notranslate"><span class="pre">mode</span> <span class="pre">3</span></code> is the prediction mode and brings the NNP to application.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Keyword</p></th>
<th class="head"><p>Default</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>runner_mode</p></td>
<td><p>1</p></td>
<td class="text-left"><p>Must be set to 3.</p></td>
</tr>
<tr class="row-odd"><td><p>calculate_forces</p></td>
<td><p>True</p></td>
<td class="text-left"><p>Calculate the atomic forces in runner_mode 3 and write them to the files runner.out and nnforces.out.</p></td>
</tr>
</tbody>
</table>
<p>We start the calculation following the same pattern as for mode 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run Mode 3.</span>
<span class="n">mode3</span> <span class="o">=</span> <span class="n">mode2</span><span class="o">.</span><span class="n">restart</span><span class="p">(</span><span class="s1">&#39;fit_mode3&#39;</span><span class="p">)</span>
<span class="n">mode3</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">runner_mode</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">mode3</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">calculate_forces</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">mode3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">delete_existing_job</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DataContainer({&#39;parameters&#39;: DataContainer({&#39;runner_mode&#39;: 3, &#39;elements&#39;: None, &#39;number_of_elements&#39;: 0, &#39;bond_threshold&#39;: 0.5, &#39;nn_type_short&#39;: 1, &#39;use_short_nn&#39;: 1, &#39;optmode_charge&#39;: 1, &#39;optmode_short_energy&#39;: 1, &#39;optmode_short_force&#39;: 1, &#39;points_in_memory&#39;: 1000, &#39;scale_symmetry_functions&#39;: 1, &#39;cutoff_type&#39;: 1, &#39;test_fraction&#39;: 0.1, &#39;use_short_forces&#39;: 1, &#39;epochs&#39;: 15, &#39;kalman_lambda_short&#39;: 0.98, &#39;kalman_nue_short&#39;: 0.9987, &#39;mix_all_points&#39;: 1, &#39;nguyen_widrow_weights_short&#39;: 1, &#39;repeated_energy_update&#39;: 1, &#39;short_energy_error_threshold&#39;: 0.1, &#39;short_energy_fraction&#39;: 1.0, &#39;short_force_error_threshold&#39;: 1.0, &#39;short_force_fraction&#39;: 0.1, &#39;use_old_weights_charge&#39;: 0, &#39;use_old_weights_short&#39;: 0, &#39;write_weights_epoch&#39;: 5, &#39;center_symmetry_functions&#39;: 1, &#39;precondition_weights&#39;: 1, &#39;global_activation_short&#39;: [[&#39;t&#39;, &#39;t&#39;, &#39;l&#39;]], &#39;global_hidden_layers_short&#39;: 2, &#39;global_nodes_short&#39;: [[15, 15]], &#39;calculate_forces&#39;: True, &#39;symfunction_short&#39;: [(&#39;Li&#39;, 2, &#39;Li&#39;, 0.0, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.004675055980246072, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.010843416275634649, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.01939424193215976, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.03192971575337408, 0.0, 12.0), (&#39;Li&#39;, 2, &#39;Li&#39;, 0.05159916711157465, 0.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, -1.0, 1.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, -1.0, 2.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, -1.0, 4.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, -1.0, 8.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, 1.0, 1.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, 1.0, 2.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, 1.0, 4.0, 12.0), (&#39;Li&#39;, 3, &#39;Li&#39;, &#39;Li&#39;, 0.0, 1.0, 8.0, 12.0)]}), &#39;training_data&#39;: &lt;pyiron_contrib.atomistics.atomistics.job.trainingcontainer.TrainingStorage object at 0x7ff3c6db9630&gt;})
The job fit_mode3 was saved and received the ID: 240
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/kalm/dcmnts/uni/promotion/src/runnerase/runnerase/io/ase.py:313: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray.
  forces = np.array([i.get_forces() for i in pred_structures])
</pre></div>
</div>
</div>
</div>
<p>As we turned on <code class="docutils literal notranslate"><span class="pre">calculate_forces</span></code>, mode 3 will give us the energy and force for each structure in the training and testing datasets. Take a look at the <code class="docutils literal notranslate"><span class="pre">output</span></code> to see that we now have access to all possible output properties.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mode3</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">list_nodes</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;sfvalues&#39;,
 &#39;splittraintest&#39;,
 &#39;fitresults&#39;,
 &#39;weights&#39;,
 &#39;scaling&#39;,
 &#39;energy&#39;,
 &#39;forces&#39;]
</pre></div>
</div>
</div>
</div>
<p>For a more detailed analyze, we can have a look at the atomic energy and force prediction of the NNP compared to the reference values. For a perfect fit, all points will be on the diagonal of the plot. In this plot, we can identify, for example, whether some energies ranges are not well described in our data set. This could be related to our first data set analysis above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">mode3</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">energy_scatter_histogram</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/27b80e49ee4132a65d595467d7be4cc1979d7f2cd074ef822aeed84cd348ade4.png" src="../../_images/27b80e49ee4132a65d595467d7be4cc1979d7f2cd074ef822aeed84cd348ade4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">mode3</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">force_scatter_histogram</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bf352897587f120153ca0184359963d5773bdcf42dff13684abaa73912116c0a.png" src="../../_images/bf352897587f120153ca0184359963d5773bdcf42dff13684abaa73912116c0a.png" />
</div>
</div>
</section>
<section id="lammps-using-the-potential">
<h3>LAMMPS: Using the Potential<a class="headerlink" href="#lammps-using-the-potential" title="Permalink to this heading">#</a></h3>
<p>After successfully running modes 1 through 3, the potential is ready for application. Via <a class="reference external" href="https://compphysvienna.github.io/n2p2/index.html">n2p2</a>, the NNP can be used in combination with LAMMPS to drive large-scale atomistic simulations.</p>
<p>As was done for previous potentials, we create a pandas dataframe holding all the relevant pieces of information about the potential using <code class="docutils literal notranslate"><span class="pre">get_lammps_potential</span></code>. <strong>API break:</strong> In our case, we need to specifically define the <code class="docutils literal notranslate"><span class="pre">elements</span></code> present in the simulations. Otherwise, the mapping between species in n2p2 and LAMMPS might be off.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pot</span> <span class="o">=</span> <span class="n">mode3</span><span class="o">.</span><span class="n">get_lammps_potential</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Li&#39;</span><span class="p">])</span>

<span class="n">display</span><span class="p">(</span><span class="n">pot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Filename</th>
      <th>Model</th>
      <th>Species</th>
      <th>Config</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>RuNNer-Li</td>
      <td>[/home/kalm/dcmnts/uni/promotion/work/workshop_bochum/handson_notebook/workshop_preparation/introduction/training/fit_lithium/fit_mode3_hdf5/fit_mode3/input.nn, /home/kalm/dcmnts/uni/promotion/wor...</td>
      <td>RuNNer</td>
      <td>[Li]</td>
      <td>[pair_style hdnnp 6.350126526766093 dir "./" showew yes showewsum 0 resetew no maxew 100 cflength 1.8897261328 cfenergy 0.0367493254\n, pair_coeff * * Li\n]</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As a first application, we are going to calculate the energy-volume curve of bulk lithium. This requires the minimization of structures with different cell geometries, a suitable first test for the stability of a new HDNNP.</p>
<p>We create a new subproject for these calculations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s1">&#39;E_V_curve&#39;</span> <span class="ow">in</span> <span class="n">pr</span><span class="o">.</span><span class="n">list_groups</span><span class="p">():</span>
    <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;E_V_curve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove_jobs</span><span class="p">(</span><span class="n">silently</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pr_ev</span> <span class="o">=</span> <span class="n">pr</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;E_V_curve&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3aecc6ad968d4852bacd5e622c8cfb44", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>Next, we create Li bulk structures, varying the cell parameter <code class="docutils literal notranslate"><span class="pre">a</span></code> between 3.0 and 4.0 Angstrom. For each structure, we create a LAMMPS job that minimizes the energy of the system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">a_list</span><span class="p">:</span>
    <span class="n">job_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;job_a_</span><span class="si">{</span><span class="n">a</span><span class="si">:</span><span class="s1">.4</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">job</span> <span class="o">=</span> <span class="n">pr_ev</span><span class="o">.</span><span class="n">create</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">Lammps</span><span class="p">(</span><span class="n">job_name</span><span class="p">,</span> <span class="n">delete_existing_job</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">job</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">pr_ev</span><span class="o">.</span><span class="n">create_ase_bulk</span><span class="p">(</span><span class="s1">&#39;Li&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
    <span class="n">job</span><span class="o">.</span><span class="n">potential</span> <span class="o">=</span> <span class="n">pot</span>
    <span class="n">job</span><span class="o">.</span><span class="n">calc_minimize</span><span class="p">()</span>
    <span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">delete_existing_job</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pyiron_atomistics.lammps.base.Input object at 0x7ff3c94d24a0&gt;
The job job_a_3_0 was saved and received the ID: 241
reading output
&lt;pyiron_atomistics.lammps.base.Input object at 0x7ff3c94d3700&gt;
The job job_a_3_167 was saved and received the ID: 242
reading output
&lt;pyiron_atomistics.lammps.base.Input object at 0x7ff3c94901f0&gt;
The job job_a_3_333 was saved and received the ID: 243
reading output
&lt;pyiron_atomistics.lammps.base.Input object at 0x7ff3c9436ef0&gt;
The job job_a_3_5 was saved and received the ID: 244
reading output
&lt;pyiron_atomistics.lammps.base.Input object at 0x7ff3c4769ab0&gt;
The job job_a_3_667 was saved and received the ID: 245
reading output
&lt;pyiron_atomistics.lammps.base.Input object at 0x7ff3c9403e80&gt;
The job job_a_3_833 was saved and received the ID: 246
reading output
&lt;pyiron_atomistics.lammps.base.Input object at 0x7ff3c9401c30&gt;
The job job_a_4_0 was saved and received the ID: 247
reading output
</pre></div>
</div>
</div>
</div>
<p>Finally, we create a plot from the collected data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">volume_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">energy_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">pr_ev</span><span class="o">.</span><span class="n">iter_jobs</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;finished&#39;</span><span class="p">):</span>
    <span class="n">min_volume</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="s1">&#39;output/generic/volume&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">min_energy</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="s1">&#39;output/generic/energy_tot&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">volume_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_volume</span><span class="p">)</span>
    <span class="n">energy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_energy</span><span class="p">)</span>

<span class="n">volume_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">volume_list</span><span class="p">)</span>
<span class="n">energy_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energy_list</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">volume_list</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">volume_list</span><span class="p">[</span><span class="n">args</span><span class="p">],</span> <span class="n">energy_list</span><span class="p">[</span><span class="n">args</span><span class="p">],</span> <span class="s1">&#39;-x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Volume [$\mathrm{\AA^3}$]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy [eV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a35e6dc45f4e41fe8ef98df2d29ac5f4", "version_major": 2, "version_minor": 0}</script><img alt="../../_images/201c9e072f55991fd4a4bd11dcff9f0efd5ade5bf71d05ba19e852514c6b0908.png" src="../../_images/201c9e072f55991fd4a4bd11dcff9f0efd5ade5bf71d05ba19e852514c6b0908.png" />
</div>
</div>
</section>
</section>
<section id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this heading">#</a></h2>
<p>Great that you have already come this far in the notebook! If you still have some time left, we invite you to play with a few key parameters of RuNNer to experience firsthand how they can influence the fit.</p>
<p><strong>Important:</strong> Feel free to change whatever parameters you find interesting. However, keep in mind that using a very large neural network architecture or a significantly bigger portion of the full dataset will result in very long training times much exceeding the timeframe of this tutorial.</p>
<p>Here are a few suggestions:</p>
<ol class="arabic simple">
<li><p>Choose a different training dataset.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">precondition_weights</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p>Experience overfitting by choosing a larger neural network architecture. We recommend 3 hidden layers with 25 nodes each.</p></li>
<li><p>Experience a really quick fit by setting <code class="docutils literal notranslate"><span class="pre">use_short_forces</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p>Observe that the training outcome can vary depending on different choices of the variable <code class="docutils literal notranslate"><span class="pre">random_seed</span></code>.</p></li>
</ol>
</section>
<section id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this heading">#</a></h2>
<p>Here is a collection of all the resources mentioned in the text. These are a very good starting points towards using RuNNer in your own research!</p>
<ul class="simple">
<li><p>Technical Documentation:</p>
<ul>
<li><p><a class="reference external" href="https://theochemgoettingen.gitlab.io/RuNNer">The RuNNer documentation</a>.</p></li>
<li><p><a class="reference external" href="https://runner-suite.gitlab.io/runnerase/">The runnerase documentation</a>.</p></li>
<li><p><a class="reference external" href="https://compphysvienna.github.io/n2p2/index.html">The n2p2 documentation</a>.</p></li>
</ul>
</li>
<li><p>Second Generation HDNNP:</p>
<ul>
<li><p><a class="reference external" href="https://www.doi.org/10.1103/PhysRevLett.98.146401">J. Behler, M. Parrinello, Phys. Rev. Lett. 2007, 98, 146401</a>.</p></li>
<li><p><a class="reference external" href="https://www.doi.org/10.1002/qua.24890">J. Behler, International Journal of Quantum Chemistry 2015, 115, 1032–1050</a>.</p></li>
<li><p><a class="reference external" href="https://www.doi.org/10.1002/anie.201703114">J. Behler, Angewandte Chemie International Edition 2017, 56, 12828–12840</a>.</p></li>
</ul>
</li>
<li><p>Third Generation HDNNP:</p>
<ul>
<li><p><a class="reference external" href="https://www.doi.org/10.1103/PhysRevB.83.153101">N. Artrith, T. Morawietz, J. Behler, Phys. Rev. B 2011, 83, 153101</a>.</p></li>
<li><p><a class="reference external" href="https://www.doi.org/10.1063/1.3682557">T. Morawietz, V. Sharma, J. Behler, J. Chem. Phys. 2012, 136, 064103</a>.</p></li>
</ul>
</li>
<li><p>Fourth Generation HDNNP:</p>
<ul>
<li><p><a class="reference external" href="https://www.doi.org/10.1038/s41467-020-20427-2">T. W. Ko, J. A. Finkler, S. Goedecker, J. Behler, Nature Communications 2021, 12, 398</a>.</p></li>
<li><p><a class="reference external" href="https://www.doi.org/10.1021/acs.accounts.0c00689">T. W. Ko, J. A. Finkler, S. Goedecker, J. Behler, Acc. Chem. Res. 2021, 54, 808–817</a>.</p></li>
</ul>
</li>
<li><p>Atom-centered Symmetry Functions:</p>
<ul>
<li><p><a class="reference external" href="https://www.doi.org/10.1063/1.3553717">J. Behler, The Journal of Chemical Physics 2011, 134, 074106.</a>.</p></li>
</ul>
</li>
<li><p>Further Reading / Tutorial Reviews:</p>
<ul>
<li><p><a class="reference external" href="https://www.doi.org/10.1088/0953-8984/26/18/183001">J. Behler, Journal of Physics: Condensed Matter 2014, 26, 183001</a>.</p></li>
<li><p><a class="reference external" href="https://www.doi.org/10.1039/C1CP21668F">J. Behler, Phys. Chem. Chem. Phys. 2011, 13, 17930–17955</a>.</p></li>
<li><p><a class="reference external" href="https://www.doi.org/10.1002/qua.24890">J. Behler, International Journal of Quantum Chemistry 2015, 115, 1032–1050</a>.</p></li>
</ul>
</li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./02_fitting/02-HDNNP"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../01-EAM/IntroductionPotentialFitting.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">EAM potentials 1: Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="../03-ACE/pacemaker_example.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Atomic cluster expansion (ACE)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#architecture-of-an-hdnnp">Architecture of an HDNNP</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#symmetry-functions-sfs">Symmetry Functions (SFs)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cutoff-functions">Cutoff Functions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#radial-symmetry-functions">Radial Symmetry Functions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#angular-symmetry-functions">Angular Symmetry Functions</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rd-and-4th-generation-hdnnps">3rd and 4th Generation HDNNPs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#repetition-second-generation-hdnnp">Repetition: Second Generation HDNNP</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#third-generation-hdnnp">Third Generation HDNNP</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fourth-generation-hdnnp">Fourth Generation HDNNP</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-runner-via-the-pyiron-interface">Using RuNNer via the pyiron Interface</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data Preparation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#job-setup-runnerfit">Job Setup: <code class="docutils literal notranslate"><span class="pre">RunnerFit</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-training-data">Adding Training Data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#specification-of-runner-parameters">Specification of RuNNer Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-sfs-with-runnerase">Generating SFs with <code class="docutils literal notranslate"><span class="pre">runnerase</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-sfs-to-the-job">Adding SFs to the Job</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mode-1-calculation-of-sf-values">Mode 1: Calculation of SF Values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mode-2-potential-training">Mode 2: Potential Training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mode-3-potential-evaluation">Mode 3: Potential Evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lammps-using-the-potential">LAMMPS: Using the Potential</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resources">Resources</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By pyiron
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>